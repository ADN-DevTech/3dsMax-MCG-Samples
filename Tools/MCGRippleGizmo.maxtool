<?xml version="1.0" encoding="utf-8"?>
<graph version="0.50" uuid="b6832597-9407-4e50-9401-af7817415a7c">
  <meta_info>
    <graph_version guid="80e59ee5-cdc3-406c-b260-413e4778fbd4" number="0.0.7" />
    <customui>--*****************************************************************************************************************
-- MCG Ripple Gizmo Rollout
-----------------------------------
-- The following rollout template is intended to be copied into the Custom UI definition of an MCG .maxtool file:
-- Edit &gt; Edit Graph Properties &gt; Custom UI &gt; Paste this code.
-- 
-- To adapt this template to your own needs, modify the code contained within the "Modifier Creation and Parameter Wiring"
-- section below. This rollout template assumes the parameters exposed by your gizmo match the ones defined on the 
-- modifier (so that they may be wired correctly).
--*****************************************************************************************************************
rollout params "Parameters" width:160 height:128
(	
	-- Define a  filter function to ensure the pick buttons below can only select geometry.
	fn IsGeometry obj = (superclassof obj == GeometryClass)
	
	-- The string below will be replaced by the auto-generated UI definitions from MCG.
	-- This way, we do not have to redefine the spinners and other UI elements expected by the plugin's parameter block.
	&lt;&lt;ParamUIDefs&gt;&gt;
	
	-- Add the custom UI elements after the MCG UI definitions.
	pickbutton 'updatePickBtn' "Update Box from Object" width:155 height:16 message:"Pick a Mesh" filter:IsGeometry align:#left
	pickbutton 'applyPickBtn' "Apply to Object" width:155 height:16 message:"Pick a Mesh" filter:IsGeometry align:#left
	
	-- The string below will be replaced by the auto-generated UI element event handlers from MCG.
	&lt;&lt;RolloutParamsHandlers&gt;&gt;
	
	-- Update the box corners with the given object's bounding box. This affects how the spline is generated within MCG.
	fn UpdateBoundingBoxParams obj = (
		bb = nodeGetBoundingBox obj obj.transform
		min_point = bb[1]
		max_point = bb[2]
		
		minCorner.X = min_point[1]
		minCorner.Y = min_point[2]
		minCorner.Z = min_point[3]
		
		maxCorner.X = max_point[1]
		maxCorner.Y = max_point[2]
		maxCorner.Z = max_point[3]
	)
	
	-- Apply the modifier to the given object.
	fn ApplyMCGModifier obj = (
		
		-- Update the local bounding box parameters.
		UpdateBoundingBoxParams obj
		
		--*****************************************************************************************************************
		-- Modifier Creation and Parameter Wiring                                                                                                               *
		--*****************************************************************************************************************
		-- Create an instance of the associated modifier.
		-- If you are using this file as a template, change this to an instance of your custom modifier
		newMod = MCGRipple() 
		
		-- Wire the current gizmo's parameters to the modifier's parameters.
		-- If you are using this file as a template, change the parameter wiring below to suit the parameters on your own modifier.
		--
		-- (!) Note: Due to a recently discovered issue (from Max 2014 through 2017),  paramWire.connect2way causes a crash
		-- when a wired object is cloned (this applies to non-MCG objects as well). As a workaround, we're using the more stable 
		-- paramWire.connect instead. The limitation is that the modifier's parameters will now be driven by the gizmo exclusively.
 		paramWire.connect owningNode.baseObject[#amplitude1] newMod[#amplitude1] "amplitude1"
		paramWire.connect owningNode.baseObject[#amplitude2] newMod[#amplitude2] "amplitude2"
		paramWire.connect owningNode.baseObject[#waveLength] newMod[#waveLength] "waveLength"
		paramWire.connect owningNode.baseObject[#phase] newMod[#phase] "phase"
		paramWire.connect owningNode.baseObject[#decay] newMod[#decay] "decay"
		--*****************************************************************************************************************
		
		-- Add the instance of the modifier
		addModifier obj newMod
		
		newMod.gizmo = owningNode
	)
	
	-- Apply pick button event handler.
	on applyPickBtn picked obj do
	(
		ApplyMCGModifier obj
	)
	
	-- Update pick button event handler.
	on updatePickBtn picked obj do
	(
		UpdateBoundingBoxParams obj
	)
)
</customui>
  </meta_info>
  <nodes>
    <node operator="Shape: Matrix" id="3" position="1329:769" size="140:91" />
    <node operator="Parameter: Int32" id="14" name="numSubdivisions" min_value="2" max_value="100" default_value="20" position="560:540" size="140:175" />
    <node operator="SplineBoxPrimitive" id="2" position="820:380" size="140:154" />
    <node operator="IgnoreSecond" id="17" position="1520:580" size="140:133" />
    <node operator="Output: shape" id="1" position="1700:620" size="140:70" />
    <node operator="SineWaveSpline" id="4" position="1320:440" size="140:238" />
    <node operator="Parameter: Single" id="18" name="waveLength" min_value="-10000" max_value="10000" default_value="10" system_units_value="true" position="820:980" size="140:196" />
    <node operator="Divide" id="19" position="1040:1420" size="140:133" />
    <node operator="Parameter: Single" id="20" name="amplitude1" min_value="-10000" max_value="10000" default_value="0" system_units_value="true" position="820:620" size="140:196" />
    <node operator="Constant" id="21" value="1000.0" position="820:1540" size="140:91" />
    <node operator="Parameter: Single" id="23" name="decay" min_value="-10000" max_value="10000" default_value="0" system_units_value="false" position="820:1360" size="140:196" />
    <node operator="Parameter: Single" id="27" name="phase" min_value="-10000" max_value="10000" default_value="0" system_units_value="false" position="820:1180" size="140:196" />
    <node operator="Parameter: Single" id="28" name="amplitude2" min_value="-10000" max_value="10000" default_value="2" system_units_value="true" position="820:800" size="140:196" />
    <node operator="MatrixIdentity" id="29" position="820:540" size="140:91" />
    <node operator="Parameter: Vector3" id="15" name="minCorner" min_value="[-1000000,-1000000,-1000000]" max_value="[1000000,1000000,1000000]" default_value="[-10,-10,0]" position="560:180" size="140:175" />
    <node operator="Parameter: Vector3" id="0" name="maxCorner" min_value="[-1000000,-1000000,-1000000]" max_value="[1000000,1000000,1000000]" default_value="[10,10,40]" position="560:360" size="140:175" />
    <node groupnode="Required" id="22" position="1320:680" size="158:189" bg_color="#ffc0c0c0">
      <comment>We need this node to ensure the plugin's owningNode variable gets instantiated.</comment>
      <nodes>3</nodes>
    </node>
  </nodes>
  <connections>
    <connection sourcenode="15" sourceport="0" destnode="2" destport="0" />
    <connection sourcenode="0" sourceport="0" destnode="2" destport="1" />
    <connection sourcenode="14" sourceport="0" destnode="2" destport="2" />
    <connection sourcenode="4" sourceport="0" destnode="17" destport="0" />
    <connection sourcenode="3" sourceport="0" destnode="17" destport="1" />
    <connection sourcenode="17" sourceport="0" destnode="1" destport="0" />
    <connection sourcenode="2" sourceport="0" destnode="4" destport="0" />
    <connection sourcenode="29" sourceport="0" destnode="4" destport="1" />
    <connection sourcenode="20" sourceport="0" destnode="4" destport="2" />
    <connection sourcenode="28" sourceport="0" destnode="4" destport="3" />
    <connection sourcenode="18" sourceport="0" destnode="4" destport="4" />
    <connection sourcenode="27" sourceport="0" destnode="4" destport="5" />
    <connection sourcenode="19" sourceport="0" destnode="4" destport="6" />
    <connection sourcenode="23" sourceport="0" destnode="19" destport="0" />
    <connection sourcenode="21" sourceport="0" destnode="19" destport="1" />
  </connections>
</graph>