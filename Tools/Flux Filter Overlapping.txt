(InstanceState state, TriMesh mesh, Int32 flux channel, Boolean keep only overlapping) => 
  {
    MapChannel _0GetMapChannel;// 19:MatricesFromMapChannel-ext->9:GetMapChannel 97356
    IArray[Vector3] _1MapChannelVertexBuffer;// 19:MatricesFromMapChannel-ext->8:MapChannelVertexBuffer 97355
    Int32 _2Count;// 2:Slices->2:Count 97352
    Int32 _3Constant;// 19:MatricesFromMapChannel-ext->0:Constant 97357
    Int32 _4Divide;// 2:Slices->3:Divide 97351
    IArray[Int32] _5Range;// 2:Slices->4:Range 97350
    IArray[IArray[Vector3]] _6Map;// 2:Slices->5:Map 97349
    IArray[Matrix] _7Map;// 19:MatricesFromMapChannel-ext->5:Map 97346
    IArray[Matrix] _51Pass-through: array;// 0:Pass-through: array 97251
    Func[Matrix, IArray[Vector3]] _52Pass-through: function1;// 0:Pass-through: function1 97254
    IArray[IArray[Vector3]] _53Map;// 5:FlatMap->4:Map 97256
    IArray[Vector3] _54Flatten;// 5:FlatMap->3:Flatten 97255
    IArray[Int32] _55MeshIndices;// 6:MapChannelStoreMatrices-ext->0:MeshIndices 97265
    TriMesh _56SetMapChannel;// 6:MapChannelStoreMatrices-ext->7:SetMapChannel 97252
    _0GetMapChannel = GetMapChannel(mesh, flux channel);
    _1MapChannelVertexBuffer = MapChannelVertexBuffer(_0GetMapChannel);
    _2Count = Count(_1MapChannelVertexBuffer);
    _3Constant = 4;
    _4Divide = Divide(_2Count, _3Constant);
    _5Range = Range(_4Divide);
    _6Map = Map(_5Range, (Int32 x0) => 
      {
        Int32 _0Multiply;// 2:Slices->6:Multiply 97354
        IArray[Vector3] _1Slice;// 2:Slices->0:Slice 97353
        _0Multiply = Multiply(_3Constant, x0);
        _1Slice = Slice(_1MapChannelVertexBuffer, _0Multiply, _3Constant);
        _1Slice;
        });
    _7Map = Map(_6Map, (IArray[Vector3] x0) => 
      {
        Matrix _0MatrixIdentity;// 0:SetMatrixFrom3Rows->23:MatrixIdentity 97366
        Int32 _1One;// 0:SetMatrixFrom3Rows->24:One 97367
        Int32 _2Zero;// 6:MatrixFromRows-ext->7:Zero 97371
        Vector3 _3At;// 6:MatrixFromRows-ext->3:At 97370
        Matrix _4SetMatrixRow;// 0:SetMatrixFrom3Rows->22:SetMatrixRow 97365
        Int32 _5Two;// 0:SetMatrixFrom3Rows->26:Two 97368
        Int32 _6One;// 8:PlusOne->1:One 97375
        Int32 _7Add;// 8:PlusOne->0:Add 97374
        Vector3 _8At;// 6:MatrixFromRows-ext->4:At 97372
        Matrix _9SetMatrixRow;// 0:SetMatrixFrom3Rows->27:SetMatrixRow 97364
        Int32 _10Constant;// 25:Three->0:Constant 97369
        Int32 _11One;// 9:PlusOne->1:One 97379
        Int32 _12Add;// 9:PlusOne->0:Add 97378
        Vector3 _13At;// 6:MatrixFromRows-ext->5:At 97376
        Matrix _14SetMatrixRow;// 0:SetMatrixFrom3Rows->28:SetMatrixRow 97363
        Int32 _15One;// 10:PlusOne->1:One 97383
        Int32 _16Add;// 10:PlusOne->0:Add 97382
        Vector3 _17At;// 6:MatrixFromRows-ext->6:At 97380
        Matrix _18SetMatrixTranslation;// 6:MatrixFromRows-ext->2:SetMatrixTranslation 97359
        _0MatrixIdentity = MatrixIdentity();
        _1One = One();
        _2Zero = Zero();
        _3At = At(x0, _2Zero);
        _4SetMatrixRow = SetMatrixRow(_0MatrixIdentity, _1One, _3At);
        _5Two = Two();
        _6One = One();
        _7Add = Add(_2Zero, _6One);
        _8At = At(x0, _7Add);
        _9SetMatrixRow = SetMatrixRow(_4SetMatrixRow, _5Two, _8At);
        _10Constant = 3;
        _11One = One();
        _12Add = Add(_7Add, _11One);
        _13At = At(x0, _12Add);
        _14SetMatrixRow = SetMatrixRow(_9SetMatrixRow, _10Constant, _13At);
        _15One = One();
        _16Add = Add(_12Add, _15One);
        _17At = At(x0, _16Add);
        _18SetMatrixTranslation = SetMatrixTranslation(_14SetMatrixRow, _17At);
        _18SetMatrixTranslation;
        });
    _51Pass-through: array = if (keep only overlapping)
      {
        IArray[Int32] _8Indices;// 0:ZipWithIndices->2:Indices 97282
        IArray[Tuple[Matrix, Int32]] _9Combine;// 0:ZipToTuple->0:Combine 97280
        IArray[Vector3] _10Map;// 14:MatrixPositions-ext->1:Map 97342
        Int32 _11Count;// 3:LastIndex->2:Count 97328
        Int32 _12One;// 3:MinusOne->2:One 97327
        Int32 _13Subtract;// 3:MinusOne->1:Subtract 97326
        IArray[Vector3] _14Take;// 1:DropLast->2:Take 97323
        Int32 _15One;// 2:SkipOne->2:One 97331
        IArray[Vector3] _16Skip;// 2:SkipOne->3:Skip 97330
        Func[Vector3, Vector3, Vector3] _17Pass-through: function2;// 0:Pass-through: function2 97320
        IArray[Vector3] _18Combine;// 1:CombinePairwiseElements-ext->3:Combine 97321
        IArray[Boolean] _19Map;// 0:PointsOverlappingNeighbours-ext->1:Map 97317
        Boolean _20True;// 0:PointsOverlappingNeighbours-ext->6:True 97338
        IArray[Boolean] _21Append;// 0:PointsOverlappingNeighbours-ext->4:Append 97316
        IArray[Boolean] _22Prepend;// 0:PointsOverlappingNeighbours-ext->9:Prepend 97339
        IArray[Boolean] _23Combine;// 0:PointsOverlappingNeighbours-ext->10:Combine 97315
        IArray[Boolean] _24Map;// 4:NegateBooleanValues-ext->2:Map 97312
        Func[Int32, Boolean] _25Pass-through: function1;// 0:Pass-through: function1 97274
        Int32 _26Zero;// 16:First->2:Zero 97296
        Matrix _27At;// 16:First->0:At 97295
        IArray[Tuple[Matrix, Int32]] _28Filter;// 2:FilterIndices-ext->1:Filter 97276
        IArray[Matrix] _29Map;// 2:FilterIndices-ext->13:Map 97275
        _8Indices = Indices(_7Map);
        _9Combine = Combine(_7Map, _8Indices, (Matrix x0, Int32 x1) => 
          {
            Tuple[Matrix, Int32] _0Pair;// 0:ZipToTuple->4:Pair 97281
            _0Pair = Pair(x0, x1);
            _0Pair;
            });
        _10Map = Map(_7Map, (Matrix x0) => 
          {
            Vector3 _0GetMatrixTranslation;// 14:MatrixPositions-ext->2:GetMatrixTranslation 97343
            _0GetMatrixTranslation = GetMatrixTranslation(x0);
            _0GetMatrixTranslation;
            });
        _11Count = Count(_10Map);
        _12One = One();
        _13Subtract = Subtract(_11Count, _12One);
        _14Take = Take(_10Map, _13Subtract);
        _15One = One();
        _16Skip = Skip(_10Map, _15One);
        _17Pass-through: function2 = (Vector3 x0, Vector3 x1) => 
          {
            Vector3 _0Subtract;// 7:AdjacentDifferences-ext->2:Subtract 97332
            _0Subtract = Subtract(x0, x1);
            _0Subtract;
            };
        _18Combine = Combine(_14Take, _16Skip, _17Pass-through: function2);
        _19Map = Map(_18Combine, (Vector3 x0) => 
          {
            Single _0Length;// 2:VectorIsSmall-ext->3:Length 97336
            Single _1Constant;// 4:VectorLengthEpsilon-ext->0:Constant 97337
            Boolean _2LessThan;// 2:VectorIsSmall-ext->5:LessThan 97335
            Boolean _3Not;// 0:PointsOverlappingNeighbours-ext->8:Not 97333
            _0Length = Length(x0);
            _1Constant = 1E-06;
            _2LessThan = LessThan(_0Length, _1Constant);
            _3Not = Not(_2LessThan);
            _3Not;
            });
        _20True = True();
        _21Append = Append(_19Map, _20True);
        _22Prepend = Prepend(_19Map, _20True);
        _23Combine = Combine(_21Append, _22Prepend, (Boolean x0, Boolean x1) => 
          {
            Boolean _0AndAlso;// 0:PointsOverlappingNeighbours-ext->11:AndAlso 97340
            _0AndAlso = AndAlso(x0, x1);
            _0AndAlso;
            });
        _24Map = Map(_23Combine, (Boolean x0) => 
          {
            Boolean _0Not;// 4:NegateBooleanValues-ext->3:Not 97313
            _0Not = Not(x0);
            _0Not;
            });
        _25Pass-through: function1 = (Int32 x0) => 
          {
            Boolean _0At;// 12:FilterUsingBooleans-ext->4:At 97310
            _0At = At(_24Map, x0);
            _0At;
            };
        _26Zero = Zero();
        _27At = At(_7Map, _26Zero);
        _28Filter = Filter(_9Combine, (Tuple[Matrix, Int32] x0) => 
          {
            Matrix _0PairItem1;// 2:FilterIndices-ext->7:PairItem1 97292
            Matrix _1Apply1;// 5:IgnoreSecondSameType-ext->6:Apply1 97289
            Matrix _2Apply1;// 5:IgnoreSecondSameType-ext->2:Apply1 97291
            Matrix _3IgnoreSecond;// 5:IgnoreSecondSameType-ext->3:IgnoreSecond 97288
            Int32 _4PairItem2;// 2:FilterIndices-ext->8:PairItem2 97298
            Int32 _5IgnoreFirst;// 2:FilterIndices-ext->11:IgnoreFirst 97285
            Boolean _6Apply1;// 2:FilterIndices-ext->6:Apply1 97284
            _0PairItem1 = PairItem1(x0);
            _1Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 5:IgnoreSecondSameType-ext->7:Identity 97290
                _0Identity = Identity(x0);
                _0Identity;
                }, _0PairItem1);
            _2Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 5:IgnoreSecondSameType-ext->7:Identity 97290
                _0Identity = Identity(x0);
                _0Identity;
                }, _27At);
            _3IgnoreSecond = IgnoreSecond(_1Apply1, _2Apply1);
            _4PairItem2 = PairItem2(x0);
            _5IgnoreFirst = IgnoreFirst(_3IgnoreSecond, _4PairItem2);
            _6Apply1 = Apply1(_25Pass-through: function1, _5IgnoreFirst);
            _6Apply1;
            });
        _29Map = Map(_28Filter, (Tuple[Matrix, Int32] x0) => 
          {
            Matrix _0PairItem1;// 2:FilterIndices-ext->14:PairItem1 97306
            Int32 _1PairItem2;// 2:FilterIndices-ext->19:PairItem2 97309
            Matrix _2IgnoreSecond;// 2:FilterIndices-ext->20:IgnoreSecond 97305
            Matrix _3Apply1;// 15:IgnoreSecondSameType-ext->6:Apply1 97302
            Matrix _4Apply1;// 15:IgnoreSecondSameType-ext->2:Apply1 97304
            Matrix _5IgnoreSecond;// 15:IgnoreSecondSameType-ext->3:IgnoreSecond 97301
            _0PairItem1 = PairItem1(x0);
            _1PairItem2 = PairItem2(x0);
            _2IgnoreSecond = IgnoreSecond(_0PairItem1, _1PairItem2);
            _3Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 15:IgnoreSecondSameType-ext->7:Identity 97303
                _0Identity = Identity(x0);
                _0Identity;
                }, _2IgnoreSecond);
            _4Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 15:IgnoreSecondSameType-ext->7:Identity 97303
                _0Identity = Identity(x0);
                _0Identity;
                }, _27At);
            _5IgnoreSecond = IgnoreSecond(_3Apply1, _4Apply1);
            _5IgnoreSecond;
            });
        _29Map;
        }else
      {
        IArray[Int32] _30Indices;// 0:ZipWithIndices->2:Indices 97396
        IArray[Tuple[Matrix, Int32]] _31Combine;// 0:ZipToTuple->0:Combine 97394
        IArray[Vector3] _32Map;// 14:MatrixPositions-ext->1:Map 97453
        Int32 _33Count;// 3:LastIndex->2:Count 97439
        Int32 _34One;// 3:MinusOne->2:One 97438
        Int32 _35Subtract;// 3:MinusOne->1:Subtract 97437
        IArray[Vector3] _36Take;// 1:DropLast->2:Take 97434
        Int32 _37One;// 2:SkipOne->2:One 97442
        IArray[Vector3] _38Skip;// 2:SkipOne->3:Skip 97441
        Func[Vector3, Vector3, Vector3] _39Pass-through: function2;// 0:Pass-through: function2 97431
        IArray[Vector3] _40Combine;// 1:CombinePairwiseElements-ext->3:Combine 97432
        IArray[Boolean] _41Map;// 0:PointsOverlappingNeighbours-ext->1:Map 97428
        Boolean _42True;// 0:PointsOverlappingNeighbours-ext->6:True 97449
        IArray[Boolean] _43Append;// 0:PointsOverlappingNeighbours-ext->4:Append 97427
        IArray[Boolean] _44Prepend;// 0:PointsOverlappingNeighbours-ext->9:Prepend 97450
        IArray[Boolean] _45Combine;// 0:PointsOverlappingNeighbours-ext->10:Combine 97426
        Func[Int32, Boolean] _46Pass-through: function1;// 0:Pass-through: function1 97388
        Int32 _47Zero;// 16:First->2:Zero 97410
        Matrix _48At;// 16:First->0:At 97409
        IArray[Tuple[Matrix, Int32]] _49Filter;// 2:FilterIndices-ext->1:Filter 97390
        IArray[Matrix] _50Map;// 2:FilterIndices-ext->13:Map 97389
        _30Indices = Indices(_7Map);
        _31Combine = Combine(_7Map, _30Indices, (Matrix x0, Int32 x1) => 
          {
            Tuple[Matrix, Int32] _0Pair;// 0:ZipToTuple->4:Pair 97395
            _0Pair = Pair(x0, x1);
            _0Pair;
            });
        _32Map = Map(_7Map, (Matrix x0) => 
          {
            Vector3 _0GetMatrixTranslation;// 14:MatrixPositions-ext->2:GetMatrixTranslation 97454
            _0GetMatrixTranslation = GetMatrixTranslation(x0);
            _0GetMatrixTranslation;
            });
        _33Count = Count(_32Map);
        _34One = One();
        _35Subtract = Subtract(_33Count, _34One);
        _36Take = Take(_32Map, _35Subtract);
        _37One = One();
        _38Skip = Skip(_32Map, _37One);
        _39Pass-through: function2 = (Vector3 x0, Vector3 x1) => 
          {
            Vector3 _0Subtract;// 7:AdjacentDifferences-ext->2:Subtract 97443
            _0Subtract = Subtract(x0, x1);
            _0Subtract;
            };
        _40Combine = Combine(_36Take, _38Skip, _39Pass-through: function2);
        _41Map = Map(_40Combine, (Vector3 x0) => 
          {
            Single _0Length;// 2:VectorIsSmall-ext->3:Length 97447
            Single _1Constant;// 4:VectorLengthEpsilon-ext->0:Constant 97448
            Boolean _2LessThan;// 2:VectorIsSmall-ext->5:LessThan 97446
            Boolean _3Not;// 0:PointsOverlappingNeighbours-ext->8:Not 97444
            _0Length = Length(x0);
            _1Constant = 1E-06;
            _2LessThan = LessThan(_0Length, _1Constant);
            _3Not = Not(_2LessThan);
            _3Not;
            });
        _42True = True();
        _43Append = Append(_41Map, _42True);
        _44Prepend = Prepend(_41Map, _42True);
        _45Combine = Combine(_43Append, _44Prepend, (Boolean x0, Boolean x1) => 
          {
            Boolean _0AndAlso;// 0:PointsOverlappingNeighbours-ext->11:AndAlso 97451
            _0AndAlso = AndAlso(x0, x1);
            _0AndAlso;
            });
        _46Pass-through: function1 = (Int32 x0) => 
          {
            Boolean _0At;// 12:FilterUsingBooleans-ext->4:At 97424
            _0At = At(_45Combine, x0);
            _0At;
            };
        _47Zero = Zero();
        _48At = At(_7Map, _47Zero);
        _49Filter = Filter(_31Combine, (Tuple[Matrix, Int32] x0) => 
          {
            Matrix _0PairItem1;// 2:FilterIndices-ext->7:PairItem1 97406
            Matrix _1Apply1;// 5:IgnoreSecondSameType-ext->6:Apply1 97403
            Matrix _2Apply1;// 5:IgnoreSecondSameType-ext->2:Apply1 97405
            Matrix _3IgnoreSecond;// 5:IgnoreSecondSameType-ext->3:IgnoreSecond 97402
            Int32 _4PairItem2;// 2:FilterIndices-ext->8:PairItem2 97412
            Int32 _5IgnoreFirst;// 2:FilterIndices-ext->11:IgnoreFirst 97399
            Boolean _6Apply1;// 2:FilterIndices-ext->6:Apply1 97398
            _0PairItem1 = PairItem1(x0);
            _1Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 5:IgnoreSecondSameType-ext->7:Identity 97404
                _0Identity = Identity(x0);
                _0Identity;
                }, _0PairItem1);
            _2Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 5:IgnoreSecondSameType-ext->7:Identity 97404
                _0Identity = Identity(x0);
                _0Identity;
                }, _48At);
            _3IgnoreSecond = IgnoreSecond(_1Apply1, _2Apply1);
            _4PairItem2 = PairItem2(x0);
            _5IgnoreFirst = IgnoreFirst(_3IgnoreSecond, _4PairItem2);
            _6Apply1 = Apply1(_46Pass-through: function1, _5IgnoreFirst);
            _6Apply1;
            });
        _50Map = Map(_49Filter, (Tuple[Matrix, Int32] x0) => 
          {
            Matrix _0PairItem1;// 2:FilterIndices-ext->14:PairItem1 97420
            Int32 _1PairItem2;// 2:FilterIndices-ext->19:PairItem2 97423
            Matrix _2IgnoreSecond;// 2:FilterIndices-ext->20:IgnoreSecond 97419
            Matrix _3Apply1;// 15:IgnoreSecondSameType-ext->6:Apply1 97416
            Matrix _4Apply1;// 15:IgnoreSecondSameType-ext->2:Apply1 97418
            Matrix _5IgnoreSecond;// 15:IgnoreSecondSameType-ext->3:IgnoreSecond 97415
            _0PairItem1 = PairItem1(x0);
            _1PairItem2 = PairItem2(x0);
            _2IgnoreSecond = IgnoreSecond(_0PairItem1, _1PairItem2);
            _3Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 15:IgnoreSecondSameType-ext->7:Identity 97417
                _0Identity = Identity(x0);
                _0Identity;
                }, _2IgnoreSecond);
            _4Apply1 = Apply1((Matrix x0) => 
              {
                Matrix _0Identity;// 15:IgnoreSecondSameType-ext->7:Identity 97417
                _0Identity = Identity(x0);
                _0Identity;
                }, _48At);
            _5IgnoreSecond = IgnoreSecond(_3Apply1, _4Apply1);
            _5IgnoreSecond;
            });
        _50Map;
        };
    _52Pass-through: function1 = (Matrix x0) => 
      {
        Int32 _0Constant;// 3:MatrixRows-ext->0:Constant 97260
        IArray[Int32] _1Range;// 3:MatrixRows-ext->1:Range 97259
        IArray[Vector3] _2Map;// 3:MatrixRows-ext->3:Map 97258
        _0Constant = 4;
        _1Range = Range(_0Constant);
        _2Map = Map(_1Range, (Int32 x0) => 
          {
            Int32 _0One;// 5:PlusOne->1:One 97264
            Int32 _1Add;// 5:PlusOne->0:Add 97263
            Vector3 _2MatrixRow;// 3:MatrixRows-ext->4:MatrixRow 97261
            _0One = One();
            _1Add = Add(x0, _0One);
            _2MatrixRow = MatrixRow(_1Add, x0);
            _2MatrixRow;
            });
        _2Map;
        };
    _53Map = Map(_51Pass-through: array, _52Pass-through: function1);
    _54Flatten = Flatten(_53Map);
    _55MeshIndices = MeshIndices(mesh);
    _56SetMapChannel = SetMapChannel(mesh, flux channel, _54Flatten, _55MeshIndices);
    _56SetMapChannel;
    }